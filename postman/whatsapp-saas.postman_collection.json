{
  "info": {
    "name": "WhatsApp SaaS Platform",
    "description": "API collection for WhatsApp Cloud API SaaS Platform",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:5000/api/v1" },
    { "key": "token", "value": "" }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }]
  },
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData.data && jsonData.data.token) {",
                  "    pm.collectionVariables.set('token', jsonData.data.token);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@whatsapp-saas.com\",\n  \"password\": \"Admin@123456\"\n}"
            },
            "url": "{{baseUrl}}/auth/login"
          }
        },
        {
          "name": "Get Profile",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/auth/me"
          }
        },
        {
          "name": "Register User",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"newagent@example.com\",\n  \"password\": \"Password123\",\n  \"name\": \"New Agent\",\n  \"role\": \"agent\"\n}"
            },
            "url": "{{baseUrl}}/auth/register"
          }
        }
      ]
    },
    {
      "name": "Tenants",
      "item": [
        {
          "name": "Create Tenant",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"My Business\"\n}"
            },
            "url": "{{baseUrl}}/tenants"
          }
        },
        {
          "name": "List Tenants",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/tenants"
          }
        },
        {
          "name": "Embedded Signup",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"code\": \"AUTH_CODE_FROM_META_EMBEDDED_SIGNUP\"\n}"
            },
            "url": "{{baseUrl}}/tenants/embedded-signup"
          }
        },
        {
          "name": "Check Tenant Health",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/tenants/:id/status"
          }
        }
      ]
    },
    {
      "name": "Conversations",
      "item": [
        {
          "name": "List Conversations",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/conversations?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["conversations"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "20" },
                { "key": "search", "value": "", "disabled": true }
              ]
            }
          }
        },
        {
          "name": "Get Conversation",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/conversations/:id"
          }
        },
        {
          "name": "Mark Conversation Read",
          "request": {
            "method": "PUT",
            "url": "{{baseUrl}}/conversations/:id/read"
          }
        }
      ]
    },
    {
      "name": "Messages",
      "item": [
        {
          "name": "Get Messages",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/messages/:conversationId?page=1&limit=50",
              "host": ["{{baseUrl}}"],
              "path": ["messages", ":conversationId"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "50" }
              ]
            }
          }
        },
        {
          "name": "Send Text Message",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"conversationId\": \"CONVERSATION_ID\",\n  \"body\": \"Hello from WhatsApp SaaS!\"\n}"
            },
            "url": "{{baseUrl}}/messages/send"
          }
        },
        {
          "name": "Send Template Message",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"conversationId\": \"CONVERSATION_ID\",\n  \"templateName\": \"hello_world\",\n  \"language\": \"en_US\",\n  \"components\": []\n}"
            },
            "url": "{{baseUrl}}/messages/send-template"
          }
        }
      ]
    },
    {
      "name": "Templates",
      "item": [
        {
          "name": "List Templates",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/templates"
          }
        },
        {
          "name": "Sync Templates from Meta",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/templates/sync"
          }
        }
      ]
    },
    {
      "name": "Webhook",
      "item": [
        {
          "name": "Webhook Verification (GET)",
          "request": {
            "auth": { "type": "noauth" },
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/webhook?hub.mode=subscribe&hub.verify_token=dev-verify-token&hub.challenge=test_challenge_string",
              "host": ["{{baseUrl}}"],
              "path": ["webhook"],
              "query": [
                { "key": "hub.mode", "value": "subscribe" },
                { "key": "hub.verify_token", "value": "dev-verify-token" },
                { "key": "hub.challenge", "value": "test_challenge_string" }
              ]
            }
          }
        },
        {
          "name": "Simulate Inbound Message (POST)",
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "X-Hub-Signature-256", "value": "sha256=COMPUTE_HMAC_SIGNATURE" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"object\": \"whatsapp_business_account\",\n  \"entry\": [\n    {\n      \"id\": \"WABA_ID\",\n      \"changes\": [\n        {\n          \"field\": \"messages\",\n          \"value\": {\n            \"messaging_product\": \"whatsapp\",\n            \"metadata\": {\n              \"display_phone_number\": \"+1555123456\",\n              \"phone_number_id\": \"PHONE_NUMBER_ID\"\n            },\n            \"contacts\": [\n              {\n                \"profile\": { \"name\": \"John Doe\" },\n                \"wa_id\": \"919876543210\"\n              }\n            ],\n            \"messages\": [\n              {\n                \"from\": \"919876543210\",\n                \"id\": \"wamid.UNIQUE_MESSAGE_ID\",\n                \"timestamp\": \"1700000000\",\n                \"type\": \"text\",\n                \"text\": { \"body\": \"Hello! I need help.\" }\n              }\n            ]\n          }\n        }\n      ]\n    }\n  ]\n}"
            },
            "url": "{{baseUrl}}/webhook"
          }
        }
      ]
    },
    {
      "name": "Health Check",
      "request": {
        "auth": { "type": "noauth" },
        "method": "GET",
        "url": "{{baseUrl}}/health"
      }
    }
  ]
}
